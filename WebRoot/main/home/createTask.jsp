<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"
	isELIgnored="false"%>
<%@ page contentType="text/html;charset=UTF-8"%>

<%@ taglib prefix="s" uri="/struts-tags"%>
<%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%
	String path = request.getContextPath();
	String basePath = request.getScheme() + "://" + request.getServerName() + ":" + request.getServerPort()
			+ path + "/";
%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0073)http://wyq.sina.com/view/eventAnalysis/createAnalysis.action?createType=1 -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="renderer" content="webkit">

<title>新浪微舆情-互联网大数据平台</title>
<meta name="author" content="">
<meta name="keywords"
	content="微信舆情监测,微博舆情监控,舆情监测, 舆情APP ,舆情客户端，舆情软件,互联网舆情,视频舆情,海外媒体，舆情APP ,舆情客户端，舆情预警">
<meta name="description"
	content="新浪微舆情是中国最大的舆情服务平台，提供网页、微博、微信、电子报、视频等全媒体舆情监测方案，以及舆情事件分析、舆情简报制作，舆情日周月报自动发送、海外媒体监测、竞争情报服务等">
<meta name="searchtitle"
	content="舆情监控,舆情监测,微博舆情监控,舆情监控软件,舆情监测系统,互联网舆情监测,舆情监控系统,互联网舆情监控,舆情监测软件,网络舆情监控系统">
<script>
// 百度统计代码
// 	var _hmt = _hmt || [];
// 	(function() {
// 		var hm = document.createElement("script");
// 		hm.src = "//hm.baidu.com/hm.js?aaac48a09e76ccc8767f661174d83b89";
// 		var s = document.getElementsByTagName("script")[0];
// 		s.parentNode.insertBefore(hm, s);
// 	})();
</script>
<script type="text/javascript">

var njxImgSrc = '';
var actionBase = '';
var staticResourcePath = 'http://files.wyq.cn/web';
var qrCodeImg = 'http://app.wyq.cn/QRCode/wyq_d_entry.png';
</script>
<script type="text/javascript"
	src="<%=basePath%>sinaStyle/index/jquery-1.10.2.min.js">
</script>
<script type="text/javascript"
	src="<%=basePath%>sinaStyle/index/index.js">
</script>
<script type="text/javascript"
	src="<%=basePath%>sinaStyle/index/zzsc.js">
</script>
<script type="text/javascript"
	src="<%=basePath%>sinaStyle/index/navigate.js">
</script>
<link href="<%=basePath%>sinaStyle/index/style.css" rel="stylesheet"
	type="text/css">
<link href="<%=basePath%>sinaStyle/index/zzsc.css" rel="stylesheet"
	type="text/css">
<link href="<%=basePath%>sinaStyle/index/font-icon.css" rel="stylesheet"
	type="text/css">
<script src="<%=basePath%>sinaStyle/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="<%=basePath%>Styles/js/jquery-ui.js"></script>
<link type="text/css" rel="stylesheet" href="<%=basePath%>Styles/css/ui.fancytree.css" />
<script type="text/javascript" src="<%=basePath%>Styles/js/jquery.fancytree-all.js" charset="UTF-8"></script>
</head>



<!-- 导航条用户的下拉效果-->

<!-- 页面右侧的客户端展示的效果-->





<body marginwidth="0" marginheight="0"
	style="width: 100%; background: rgb(255, 255, 255);">
	<div id="wx_pic" style="margin: 0 auto; display: none;">
		<img src="<%=basePath%>sinaStyle/index/share.png">
	</div>
	<!--
// 轻应用
<script type='text/javascript' src='http://tjs.sjs.sinajs.cn/open/thirdpart/js/frame/appclient.js' charset='utf-8'></script>
<script>
	$(function() {
		setInterval(function() {
			if (App) {
				document.body.style.height = '0px';
				document.body.style.height = 'auto';
				App.trigger('setPageHeight', $('body').css('height'));
			}
		}, 1000);
	});
</script>

// 微博内部应用
<script src="http://js.t.sinajs.cn/t5/page/js/lib/open/iframeconnect.js"></script>
<script>
	$(function() {
		setInterval(function() {
			document.body.style.height = '0px';
			document.body.style.height = 'auto';
			iconnect.trigger('setHeight', $('body').css('height').replace('px', ''));
		}, 1000);
	});
</script>
 -->


	<!-- saved from url=(0014)index:internet -->
	<meta http-equiv="X-UA-Compatible" content="IE=Edge">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta charset="UTF-8">
	<title>网络舆情系统</title>
	<meta name="keywords" content="网络舆情系统">
	<meta name="description" content="网络舆情系统">
	<link href="<%=basePath%>sinaStyle/index/other.css" rel="stylesheet"
		type="text/css">
	<link href="<%=basePath%>sinaStyle/index/eventAnalysis.css"
		rel="stylesheet" type="text/css">
	<link type="text/css" rel="stylesheet"
		href="<%=basePath%>sinaStyle/index/popModal.css">
	<link href="<%=basePath%>sinaStyle/index/tips.css" rel="stylesheet"
		type="text/css">
	<link rel="stylesheet" type="text/css"
		href="<%=basePath%>sinaStyle/index/common.css">
	<link rel="stylesheet" type="text/css"
		href="<%=basePath%>sinaStyle/index/font-icon.css">
		<!--时间插件-->
		
	<script src="<%=basePath%>sinaStyle/index/bootstrap.min.js"></script>
	<SCRIPT src="<%=basePath%>sinaStyle/My97DatePicker/WdatePicker.js"></SCRIPT>
	
	<!-- layer -->
	<link rel="stylesheet" type="text/css"
		href="<%=basePath%>/layer/mobile/need/layer.css">
	<SCRIPT src="<%=basePath%>/layer/layer.js"></SCRIPT>	
			<!--[if lt IE 10]>
<script type="text/javascript" src="http://files.wyq.cn/web/js/PIE.js"></script>
<![endif]-->
			<script language="javascript">
var jquery = $;
var fancyTree;
$(function() {
	jquery("[data-toggle='tooltip']").tooltip();
	if (window.PIE) {
		$('.rounded').each(function() {
			PIE.attach(this);
		});

	};
	

	fancyTree=jquery("#treeview").fancytree({
		checkbox: true,
		selectMode: 3,
	    icon:false,
		toggleEffect:false,
		scrollOfs:{left:0},
		source: ${jsonData}
		}).fancytree("getTree");
});
</script>



			<style>
.unClick {
	background-color: gray !important;
	border: 1px solid gray !important;
}
</style>











			<meta http-equiv="X-UA-Compatible" content="IE=Edge">
				<title>新浪微舆情_网络舆情监测</title> <script>
// 百度统计代码
// 	var _hmt = _hmt || [];
// 	(function() {
// 		var hm = document.createElement("script");
// 		hm.src = "//hm.baidu.com/hm.js?aaac48a09e76ccc8767f661174d83b89";
// 		var s = document.getElementsByTagName("script")[0];
// 		s.parentNode.insertBefore(hm, s);
// 	})();
</script>


				<script type="text/javascript">

var njxImgSrc = '';
var actionBase = '';
var staticResourcePath = 'http://files.wyq.cn/web';
</script>
				<script type="text/javascript"
					src="<%=basePath%>sinaStyle/index/jquery-1.10.2.min.js">
</script>



				<link type="text/css" rel="stylesheet"
					href="<%=basePath%>sinaStyle/index/tips.css">
					<script type="text/javascript"
						src="<%=basePath%>sinaStyle/index/tips.js">
</script>
					<input id="style" name="style" value="0" type="hidden">
						<div id="BgDiv" style="display: none"></div>
						<div id="SystemSetDiv">
							<iframe style="margin: 0px;" frameborder="0" marginheight="0"
								marginwidth="0" id="search_set" name="search_set" width="700"
								height="420" src=""> </iframe>
						</div>
						<div id="InfoDiv">
							<div class="td_title rel">
								<h1>温馨提示</h1>
								<a
									href="http://wyq.sina.com/view/eventAnalysis/createAnalysis.action?createType=1#"
									class="info_close abs">×</a>
							</div>
							<div class="td_msg">
								<span id="msg" class="msg"></span>
							</div>
							<div class="btn_div">
								<a id="submitBtn" class="submitBtn button float_l">确定</a> <a
									id="cancelBtn" class="cancelBtn button float_r">取消</a>
							</div>

						</div>
						<div id="SmsDiv">
							<iframe scrolling="no" style="" frameborder="0" marginheight="0"
								marginwidth="0" id="send_sms_frame" width="100%" height="100%"
								src=""> </iframe>
						</div>
						<div id="EditBSDiv">
							<iframe scrolling="no" style="" frameborder="0" marginheight="0"
								marginwidth="0" id="edit_bs_frame" width="100%" height="100%"
								src=""> </iframe>
						</div> <!--提示框 start-->
						<form action="" method="post" name="frmPopWin" id="frmPopWin">
							<input type="hidden" name="analysisTask.userId" value="232379">
								<input type="hidden" name="createType" value="1"> <input
									type="hidden" name="analysisTask.taskId" value="0">
										<div class="td_title rel">
											<h1>创建分析任务</h1>
											<a href="javascript:parent.hideEventDiv();"
												class="info_close abs">×</a>
										</div>
										<ul class="frmPopWin2">

											<li><span class="float_l"><font class="f_c2">*</font>任务名称：</span>
												<span> <input style="width: 495px;"
													name="taskname" type="text" placeholder="请为您的事件分析创建一个便于记忆的名字"
													class="input " id="taskname" value="" size="65"
													maxlength="10"></span> <span class="help_outline"
												style="color: #888;"><i
													class="icon icon-help_outline" data-toggle="tooltip"
													data-placement="top" title=""
													data-original-title="请为您的事件分析创建一个便于记忆的名字。"></i> </span></li>

											<li><span class="float_l"><font class="f_c2">*</font>事件涉及词：</span><span>

													<textarea style="width: 495px;" name="queryword" placeholder="请输入涉及词，中间点击+或者|隔开(例如:上海+浦东)"
														cols="67" rows="3" class="inputDH  " id="queryword" onclick="getId()"></textarea>
											</span> <span class="help_outline" style="color: #888;"><i
													class="icon icon-help_outline" data-toggle="tooltip"
													data-placement="top" title=""
													data-original-title="事件涉及词允许输入2个字以上的词语，可用符号进行组合，“+”号表示“和”的关系，如“上海+浦东”；“|”号则表示“或”的关系。如：“李晨|范冰冰 ”，凡是涉及李晨或者范冰冰的信息都会被命中。"></i>
											</span> <!--信息量过大提示文字 start -->
												<div class="wprompt">
													<div>本次事件分析数据过大，请完善你的事件相关词语，以便获得更精准的分析报告！</div>
												</div> <!--信息量过大提示文字 end --></li>
											<li><span class="float_l">&nbsp;</span> <span style="">
													<button id="notifyModal_ex1" class="fs_btn hintModal"
														onclick="addCh(&#39;+&#39;)" type="button">+</button>
													<button id="notifyModal_ex1" class="fs_btn hintModal"
														onclick="addCh(&#39;|&#39;)" type="button">|</button> 
														<font
													class="f_c2 fz12">( 注意：请勿使用键盘，用左边按钮输入匹配符号 )</font>
											</span></li>
											<li class="clear"><span class="float_l">排除词语：</span><span>
													<textarea name="filterword" cols="67"
														rows="3" class="inputDH " id="filterword" placeholder="请输入排除词，中间点击+或者|隔开(例如:上海+浦东)"
														onclick="getId()"></textarea>
											</span> <span class="help_outline" style="color: #888;"><i
													class="icon icon-help_outline" data-toggle="tooltip"
													data-placement="top" title=""
													data-original-title="排除关键词将有效排除与您想知道的事件无关的词语。多个排除词请用'|'分割,如排除范冰冰和李晨则用范冰冰|李晨"></i>
											</span></li>
											<li class="clear"><span class="float_l"><font
													class="f_c2">*</font>任务类型：</span> 
												<select class="inputDH" name="type">
														<option value="1">涉大陆重点舆情</option>
														<option value="2">媒体焦点</option>
														<option value="3">社交网站舆情热点</option>
												</select></li>
											<li style="height:150px;">
												<span class="float_l"><font class="f_c2">*</font>数据来源：</span>
												<div id="treeview" style="overflow:auto;height:140px;"></div>
											</li>
											<li><span class="float_l"><font class="f_c2">*</font>任务时间段：</span><span>
													<input name="querydateks" type="text"
													class="input time hasDatepicker" id="starttime" placeholder="请输入起始时间"
													onClick="WdatePicker({dateFmt:'yyyy-MM-dd'})"
													readonly="readonly" style="width: 170px;"> 至 <input
													name="querydatejs" type="text" class="input time hasDatepicker" placeholder="请输入结束时间"
													id="endtime" onClick="WdatePicker({dateFmt:'yyyy-MM-dd'})"
													readonly="readonly" style="width: 170px;">
											</span></li>

											<li><span class="float_l">&nbsp;</span> <span
												class="promptNumber yellow" style="display: none;"><i
													class="icon-notification"></i><span id="tips"></span> </span></li>
										</ul>
										<div class="h10 clear"></div>
										<div class="btn_div" style="">

											<a href="javascript:createTask();" class="submitBtn2 button"
												id="submit" style="">开始分析</a> <a
												href="javascript:parent.hideEventDiv();"
												class="cancelBtn2 button">取消</a>
										</div>
										<div class="h10 clear"></div>
						</form> <!--提示框 end--> <script
							src="<%=basePath%>sinaStyle/index/popModal.js">
</script> <!--提示语js--> <script type="text/javascript">
var inputId='';
function getId(){
	inputId=event.srcElement.id;
}

// 添加字符+|()
function addCh(ch) {
	var textBox = document.getElementById(inputId);
	var start = textBox.selectionStart;
	var end = textBox.selectionEnd;
	var judge = textBox.value.substr(start-1).substr(0,1);
	var judge2 = textBox.value.substr(start).substr(0,1);
	if (judge=='+'||judge=='|'||judge2=='|'||judge2=='+'||judge=='') {
		return;
	}
	var pre = textBox.value.substr(0, start);
	var post = textBox.value.substr(end);
	textBox.value = pre + ch + post;
	start = start + 1;
	textBox.setSelectionRange(start, start);
	textBox.focus();
	/*}*/
}
function addFilterCh(ch) {
	var textBox = document.getElementById('filterword');
	var start = textBox.selectionStart;
	var end = textBox.selectionEnd;
	var judge = textBox.value.substr(start-1).substr(0,1);
	var judge2 = textBox.value.substr(start).substr(0,1);
	if (judge=='+'||judge=='|'||judge2=='|'||judge2=='+') {
		return;
	}
	var pre = textBox.value.substr(0, start);
	var post = textBox.value.substr(end);
	textBox.value = pre + ch + post;
	start = start + 1;
	textBox.setSelectionRange(start, start);
	textBox.focus();
	/*}*/
}	

var createParmas = ""
var createFlag = 0;
var isCreate = true;
function createTask() {
	$("#tips").parent().hide();
	if($.trim($("#taskname").val())==""){
		$("#tips").text("请输入任务名称！");
		$("#tips").parent().show();
		return;
	}
	var keyword = $("#queryword").val();
	if ($.trim(keyword) == "") {
		$("#tips").text("请输入事件涉及词！");
		$("#tips").parent().show();
		openClick();
		return;
	} else {
		var arr = keyword.split(/\+|\|/)
		if (arr.length < 1) {
			$("#tips").text("事件涉及词至少包含一个词！");
			$("#tips").parent().show();
			return;
		} else if (arr[0].length < 2) {
			$("#tips").text("词语至少包含二个字！");
			$("#tips").parent().show();
			return;
		}
	}
	var starttime = $("#starttime").val();
	var endtime = $("#endtime").val();
	if (starttime == "" || endtime == "") {
		$("#tips").text("请输入时间段！");
		$("#tips").parent().show();
		return;
	}
	if (new Date(starttime)>new Date(endtime)) {
		$("#tips").text("开始时间不能大于结束时间！");
		$("#tips").parent().show();
		return;
	}
	var ids=[];  
	var sourceIdStr=$.map(fancyTree.getSelectedNodes(), function(node){
		   var id=node.key;
		   ids.push(id);   
	});
	var params = $.param({'ids':ids},true);
	if (ids.length==0) {
		$("#tips").text("请勾选数据来源！");
		$("#tips").parent().show();
		return;
	}
	
	var load2 = layer.load(2);
	layer.msg('正在分析，请等待！');
	$.ajax( {
		url : "<%=basePath%>taskIndex_solrCount",
		type : "post",
		data : $("#frmPopWin").serialize()+'&'+params,
		success : function(result) {
			if (result==1) {
				saveAjax();
			}else{
				$("#tips").text("本次事件分析数据过大或没有数据，请完善你的事件涉及词，以便获得更精准的分析报告！");
				$("#tips").parent().show();
				layer.close(load2);
				return;
			}
		}
	});
	
	function saveAjax(){
		var smType=$("select[name='type']").val();
		$.ajax( {
			url : "<%=basePath%>taskIndex_saveTask",
			type : "post",
			data : $("#frmPopWin").serialize()+'&'+params,
			success : function(result) {
				layer.close(load2);
				window.parent.window.location.href="<%=basePath%>taskIndex_taskList1?type="+smType;
			}
		});
	}
}

function unClick() {
	isCreate = false;
	$("#submit").addClass("unClick");
}
function openClick() {
	isCreate = true;
	$("#submit").removeClass("unClick");
}

function copyTo() {
	$("#supplementKeyword").val(
			$("#supplementKeyword").val().trim().replace(/\++|\|+|\s+/g, " "));
	$("#keyword").val($("#supplementKeyword").val().replace(/ /g, "+"));
}
</script>
						<div id="ui-datepicker-div"
							class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>
</body>
</html>